#include <Wire.h>

#define AD 0B1110000 // E0(70)
#define CR 13
#define LF 10

#define DIGITS_14SEG 8

void i2cwrite1(unsigned char dat);
void i2cwriteLED(unsigned char dat);
void i2cwrite(unsigned int add,unsigned char dat);
unsigned char i2cread(unsigned char address);
void str_display(char *str);

char last_char = 0;
char disp_str[] = "MAENOH! ";

unsigned long int disp_buff[DIGITS_14SEG];

const unsigned char seg14[] = {
  0x00, 0x00, //Space
  0x40, 0x06, //!
  0x02, 0x20, //"
  0x12, 0xC7, //#
  0x12, 0xED, //$
  0x24, 0x24, //%
  0x0B, 0x59, //&
  0x04, 0x00, //'
  0x00, 0x39, //(
  0x00, 0x0F, //)
  0x3f, 0x00, //*
  0x12, 0xC0, //+
  0x20, 0x00, //,
  0x00, 0xC0, //-
  0x40, 0x00, //.
  0x24, 0x00, ///
  0x00, 0x3F, //0
  0x00, 0x06, //1
  0x00, 0xDB, //2
  0x00, 0xCF, //3
  0x00, 0xE6, //4
  0x00, 0xED, //5
  0x00, 0xFD, //6
  0x00, 0x27, //7
  0x00, 0xFF, //8
  0x00, 0xEF, //9
  0x0C, 0x00, //:
  0x21, 0x00, //;
  0x0C, 0x40, //<
  0x00, 0xC8, //=
  0x21, 0x80, //>
  0x50, 0x83, //?
  0x10, 0xBF, //@
  0x24, 0x86, //A
  0x04, 0xFD, //B
  0x00, 0x3B, //C
  0x12, 0x0F, //D
  0x00, 0xF9, //E
  0x00, 0x71, //F
  0x00, 0xBD, //G
  0x00, 0xF6, //H
  0x12, 0x09, //I
  0x00, 0x1E, //J
  0x0C, 0x70, //K
  0x00, 0x38, //L
  0x05, 0x36, //M
  0x09, 0x36, //N
  0x00, 0x3F, //O
  0x00, 0xF3, //P
  0x08, 0x3F, //Q
  0x08, 0xF3, //R
  0x01, 0x9D, //S
  0x12, 0x01, //T
  0x00, 0x3E, //U
  0x24, 0x30, //V
  0x28, 0x36, //W
  0x09, 0xD2, //X
  0X15, 0X08, //Y
  0x24, 0x09, //Z
  0x21, 0x00, //;
  0x0C, 0x40, //<
  0x00, 0xC8, //=
  0x21, 0x80, //>
  0x50, 0x83, //?
  0x10, 0xBF, //@
  0x30, 0x48, //a
  0x12, 0x8C, //b
  0x00, 0x58, //c
  0x12, 0x58, //d
  0x20, 0x58, //e
  0x14, 0xC0, //f
  0x04, 0x8E, //g
  0x12, 0x84, //h
  0x14, 0x00, //i
  0x04, 0x0C, //j
  0x1E, 0x00, //k
  0x32, 0x00, //l
  0x10, 0xD4, //m
  0x10, 0xC4, //n
  0x00, 0xDC, //o
  0x12, 0x83, //p
  0x12, 0x61, //q
  0x11, 0x80, //r
  0x08, 0x88, //s
  0x0A, 0xC0, //t
  0x10, 0x18, //u
  0x20, 0x10, //v
  0x28, 0x14, //w
  0x2C, 0x40, //x
  0x25, 0x00, //y
  0x20, 0x48, //z
  0x12, 0x49, //{
  0x12, 0x00, //|
  0x12, 0x89, //}
  0x00, 0x01, //~
};

void str_display(char *str) {
  int i;
  char ch;
  for (i=0; i<DIGITS_14SEG; i++) {
    ch = (str[i]-' ');
    disp_buff[DIGITS_14SEG-i-1] = ((int)seg14[ch*2]<<8) + seg14[ch*2+1];
  }
  i2cwriteLED(0);
}

void i2cwrite1(unsigned char dat){
  Wire.beginTransmission(AD);  
  Wire.write(dat); 
  Wire.endTransmission();
}

void i2cwriteLED(unsigned char dat){//
 unsigned char j;
 unsigned char i;
 Wire.beginTransmission(AD);
 Wire.write(dat);
 for (j=0; j<DIGITS_14SEG; j++) {
   i = disp_buff[j]&0xFF;
   Wire.write(i);
   i = disp_buff[j]>>8;
   Wire.write(i);
 }
 Wire.endTransmission();
}

void setup() {
  Wire.begin();
  delay(1000);
  i2cwrite1(0x21); //osc on
  delay(100);
  i2cwrite1(0x81); // [2:1]=blink:0.5Hz/1Hz/2Hz/NO, [0]:DISP_ON/OFF
  delay(100);
  //i2cwrite1(0x83); // blink]0.5Hz, DISP_ON
  i2cwrite1(0xE8); //brightness
  delay(100);
  i2cwriteLED(0x00); //LED data
  delay(100);
  str_display("M       "); delay(500);
  str_display("MA      "); delay(500);
  str_display("MAE     "); delay(500);
  str_display("MAEN    "); delay(500);
  str_display("MAENO   "); delay(500);
  str_display("MAENOH  "); delay(500);
  str_display("MAENOH! "); delay(500);
  delay(5000);
  str_display("        ");
  delay(2000);
}
  
void loop() {
  str_display("M5Stack ");
  delay(5000);
  str_display("        ");
  delay(1000);
  str_display("MicroBit");
  delay(5000);
  str_display("        ");
  delay(1000);
}
